<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/0709d28fa27699b3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0709d28fa27699b3.css" data-n-g=""/><link rel="preload" href="/_next/static/css/00db2a26629cda1f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/00db2a26629cda1f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-9eae83cb4872e906.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-01df828e572375b9.js" defer=""></script><script src="/_next/static/chunks/pages/_app-7108479f31f129c9.js" defer=""></script><script src="/_next/static/chunks/685-b7782df5e55558aa.js" defer=""></script><script src="/_next/static/chunks/pages/bits/%5Bname%5D-eb5eaec75e4668f2.js" defer=""></script><script src="/_next/static/C-814SSFJMFSiMFrA5QZR/_buildManifest.js" defer=""></script><script src="/_next/static/C-814SSFJMFSiMFrA5QZR/_ssgManifest.js" defer=""></script><script src="/_next/static/C-814SSFJMFSiMFrA5QZR/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><nav class="navBarLayout_nav__R8NZ9"><a class="" href="/">Home</a><a class="" href="/about">About</a><a class="" href="/projects">Projects</a></nav><main><div class="tableOfContentsLayout_container__EzUwh"><div class="tableOfContentsLayout_content__KYkIj"><p>I wanted to display a list of all headings on my page. This is commonly known as a &quot;table of contents&quot;.
After looking around online, I found an algorithm that was able to generate a TOC (<strong>t</strong>able <strong>o</strong>f <strong>c</strong>ontents) from a list of headings. Although only up to two levels deep. So H1s and H2s.</p>
<h1 id="old-algorithm">Old algorithm</h1>
<p>I don&#x27;t remember where I got the idea from, but here is the code. It&#x27;s more for completeness sake anyway.</p>
<pre><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-typescript" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">function</span><span> </span><span class="token" style="color:#DAD085">generateHeadingsTreeFrom</span><span class="token" style="color:#c5c8c6">(</span><span>
</span><span>    headingElements</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">HTMLHeadingElement</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">,</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">Heading</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>    </span><span class="token" style="color:#96CBFE">const</span><span> headings</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">Heading</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span> </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">;</span><span>
</span>
<span>    </span><span class="token control-flow" style="color:#96CBFE">for</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#96CBFE">const</span><span> headingElement </span><span class="token" style="color:#96CBFE">of</span><span> headingElements</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>        </span><span class="token" style="color:#96CBFE">const</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span> innerText</span><span class="token" style="color:#EDEDED">:</span><span> text</span><span class="token" style="color:#c5c8c6">,</span><span> id</span><span class="token" style="color:#c5c8c6">,</span><span> nodeName </span><span class="token" style="color:#c5c8c6">}</span><span> </span><span class="token" style="color:#EDEDED">=</span><span> headingElement</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>        </span><span class="token" style="color:#96CBFE">const</span><span> heading</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">Heading</span><span> </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span> children</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">,</span><span> id</span><span class="token" style="color:#c5c8c6">,</span><span> text </span><span class="token" style="color:#c5c8c6">}</span><span class="token" style="color:#c5c8c6">;</span><span>
</span>
<span>        </span><span class="token control-flow" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>nodeName </span><span class="token" style="color:#EDEDED">===</span><span> </span><span class="token" style="color:#A8FF60">&quot;H1&quot;</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>            headings</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">push</span><span class="token" style="color:#c5c8c6">(</span><span>heading</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>        </span><span class="token" style="color:#c5c8c6">}</span><span> </span><span class="token control-flow" style="color:#96CBFE">else</span><span> </span><span class="token control-flow" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>nodeName </span><span class="token" style="color:#EDEDED">===</span><span> </span><span class="token" style="color:#A8FF60">&quot;H2&quot;</span><span> </span><span class="token" style="color:#EDEDED">&amp;&amp;</span><span> headings</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">length</span><span> </span><span class="token" style="color:#EDEDED">&gt;</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>            headings</span><span class="token" style="color:#c5c8c6">[</span><span>headings</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">length</span><span> </span><span class="token" style="color:#EDEDED">-</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">children</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">push</span><span class="token" style="color:#c5c8c6">(</span><span>heading</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>        </span><span class="token" style="color:#c5c8c6">}</span><span>
</span><span>    </span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span>    </span><span class="token control-flow" style="color:#96CBFE">return</span><span> headings</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
</code></pre></pre>
<h1 id="setup">Setup</h1>
<p>I wanted to create an algorithm that can handle any depth. Let&#x27;s go through my thought process on how to create this.</p>
<p>First, this is the code I use to get my heading elements:</p>
<pre><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-typescript" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">const</span><span> headings </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token known-class-name" style="color:#FFFFB6;text-decoration:underline">Array</span><span class="token" style="color:#c5c8c6">.</span><span class="token module" style="color:#96CBFE">from</span><span class="token" style="color:#c5c8c6">(</span><span>
</span><span>    </span><span class="token dom" style="color:#C6C5FE">document</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">querySelectorAll</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#A8FF60">&quot;h1, h2, h3, h4, h5, h6&quot;</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">,</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token module" style="color:#96CBFE">as</span><span> </span><span class="token maybe-class-name">HTMLHeadingElement</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">;</span><span> </span><span class="token" style="color:#7C7C7C">// I&#x27;m using typescript btw :)</span><span>
</span>
<span></span><span class="token" style="color:#96CBFE">const</span><span> tocTree </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">createTocTreeFrom</span><span class="token" style="color:#c5c8c6">(</span><span>headings</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span> </span><span class="token" style="color:#7C7C7C">// This is the function to implement.</span><span>
</span>
</code></pre></pre>
<h1 id="toctreenode"><code>TocTreeNode</code></h1>
<p>Here is the <code>TocTreeNode</code> definition:</p>
<pre><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-typescript" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">interface</span><span> </span><span class="token maybe-class-name" style="color:#FFFFB6;text-decoration:underline">TocTreeNode</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>    text</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token" style="color:#A8FF60">string</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>    children</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">TocTreeNode</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
</code></pre></pre>
<h1 id="new-any-depth-toc">New &quot;any depth&quot; toc</h1>
<pre><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-typescript" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">function</span><span> </span><span class="token" style="color:#DAD085">createTocTreeFrom</span><span class="token" style="color:#c5c8c6">(</span><span>headings</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">HTMLHeadingElement</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">TocTreeNode</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>    </span><span class="token" style="color:#96CBFE">const</span><span> nodes</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">TocTreeNode</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span> </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">;</span><span>
</span>
<span>    </span><span class="token control-flow" style="color:#96CBFE">for</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#96CBFE">const</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span> tagName</span><span class="token" style="color:#c5c8c6">,</span><span> innerText</span><span class="token" style="color:#EDEDED">:</span><span> text </span><span class="token" style="color:#c5c8c6">}</span><span> </span><span class="token" style="color:#96CBFE">of</span><span> headings</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>        </span><span class="token" style="color:#96CBFE">const</span><span> matches </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#99CC99">HEADING_TAG_REGEX</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">exec</span><span class="token" style="color:#c5c8c6">(</span><span>tagName</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span>
<span>        </span><span class="token control-flow" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#EDEDED">!</span><span>matches</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>            </span><span class="token control-flow" style="color:#96CBFE">continue</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>        </span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span>        </span><span class="token" style="color:#96CBFE">const</span><span> headingLvl </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">parseInt</span><span class="token" style="color:#c5c8c6">(</span><span>matches</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span>
<span>        </span><span class="token control-flow" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>headingLvl </span><span class="token" style="color:#EDEDED">!==</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>            </span><span class="token control-flow" style="color:#96CBFE">continue</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>        </span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span>        nodes</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">push</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">{</span><span> children</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">,</span><span> text </span><span class="token" style="color:#c5c8c6">}</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>    </span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span>    </span><span class="token control-flow" style="color:#96CBFE">return</span><span> nodes</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
</code></pre></pre>
<p>The code above returns a simple list of all H1 elements.
So let&#x27;s step it up a notch. First, add an additional parameter <code>desiredLvl</code>,  so what we look for can be customized.</p>
<pre><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-typescript" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">function</span><span> </span><span class="token" style="color:#DAD085">createTocTreeFrom</span><span class="token" style="color:#c5c8c6">(</span><span>
</span><span>    headings</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">HTMLHeadingElement</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">,</span><span>
</span><span>    desiredLvl</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token" style="color:#A8FF60">number</span><span class="token" style="color:#c5c8c6">,</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">TocTreeNode</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>    </span><span class="token" style="color:#7C7C7C">// ....</span><span>
</span>
<span>    </span><span class="token control-flow" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>headingLvl </span><span class="token" style="color:#EDEDED">!==</span><span> desiredLvl</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>        </span><span class="token control-flow" style="color:#96CBFE">continue</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>    </span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span>    </span><span class="token" style="color:#7C7C7C">// ...</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
</code></pre></pre>
<p>Let&#x27;s add depth to it, by actually providing something for the <code>children</code> attribute.  For now, let&#x27;s just call the function recursively, but one level deeper, so <code>desiredLvl + 1</code>. We also want to not include previous elements, as otherwise, we would loop indefinitely.</p>
<pre><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-typescript" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">function</span><span> </span><span class="token" style="color:#DAD085">createTocTreeFrom</span><span class="token" style="color:#c5c8c6">(</span><span>
</span><span>    headings</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">HTMLHeadingElement</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">,</span><span>
</span><span>    desiredLvl</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token" style="color:#A8FF60">number</span><span class="token" style="color:#c5c8c6">,</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">TocTreeNode</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>    </span><span class="token" style="color:#96CBFE">const</span><span> nodes</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">TocTreeNode</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span> </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">;</span><span>
</span>
<span>    </span><span class="token control-flow" style="color:#96CBFE">for</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#96CBFE">let</span><span> i </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">;</span><span> i </span><span class="token" style="color:#EDEDED">&lt;</span><span> headings</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">length</span><span class="token" style="color:#c5c8c6">;</span><span> i</span><span class="token" style="color:#EDEDED">++</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>        </span><span class="token" style="color:#96CBFE">const</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span> tagName</span><span class="token" style="color:#c5c8c6">,</span><span> innerText</span><span class="token" style="color:#EDEDED">:</span><span> text </span><span class="token" style="color:#c5c8c6">}</span><span> </span><span class="token" style="color:#EDEDED">=</span><span> headings</span><span class="token" style="color:#c5c8c6">[</span><span>i</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>        </span><span class="token" style="color:#96CBFE">const</span><span> matches </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#99CC99">HEADING_TAG_REGEX</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">exec</span><span class="token" style="color:#c5c8c6">(</span><span>tagName</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span>
<span>        </span><span class="token control-flow" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#EDEDED">!</span><span>matches</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>            </span><span class="token control-flow" style="color:#96CBFE">continue</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>        </span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span>        </span><span class="token" style="color:#96CBFE">const</span><span> headingLvl </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">parseInt</span><span class="token" style="color:#c5c8c6">(</span><span>matches</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span>
<span>        </span><span class="token control-flow" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>headingLvl </span><span class="token" style="color:#EDEDED">!==</span><span> desiredLvl</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>            </span><span class="token control-flow" style="color:#96CBFE">continue</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>        </span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span>        </span><span class="token" style="color:#96CBFE">const</span><span> children </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">createTocTreeFrom</span><span class="token" style="color:#c5c8c6">(</span><span>headings</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">slice</span><span class="token" style="color:#c5c8c6">(</span><span>i </span><span class="token" style="color:#EDEDED">+</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">,</span><span> desiredLvl </span><span class="token" style="color:#EDEDED">+</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span>
<span>        nodes</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">push</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">{</span><span> children</span><span class="token" style="color:#c5c8c6">,</span><span> text </span><span class="token" style="color:#c5c8c6">}</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>    </span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span>    </span><span class="token control-flow" style="color:#96CBFE">return</span><span> nodes</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
</code></pre></pre>
<p>But this algorithm is flawed. Consider the following headings:</p>
<pre><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-html" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#c5c8c6">&lt;</span><span class="token" style="color:#96CBFE">h1</span><span class="token" style="color:#c5c8c6">&gt;</span><span>1</span><span class="token" style="color:#c5c8c6">&lt;/</span><span class="token" style="color:#96CBFE">h1</span><span class="token" style="color:#c5c8c6">&gt;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">&lt;</span><span class="token" style="color:#96CBFE">h2</span><span class="token" style="color:#c5c8c6">&gt;</span><span>1.1</span><span class="token" style="color:#c5c8c6">&lt;/</span><span class="token" style="color:#96CBFE">h2</span><span class="token" style="color:#c5c8c6">&gt;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">&lt;</span><span class="token" style="color:#96CBFE">h1</span><span class="token" style="color:#c5c8c6">&gt;</span><span>2</span><span class="token" style="color:#c5c8c6">&lt;/</span><span class="token" style="color:#96CBFE">h1</span><span class="token" style="color:#c5c8c6">&gt;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">&lt;</span><span class="token" style="color:#96CBFE">h2</span><span class="token" style="color:#c5c8c6">&gt;</span><span>2.1</span><span class="token" style="color:#c5c8c6">&lt;/</span><span class="token" style="color:#96CBFE">h2</span><span class="token" style="color:#c5c8c6">&gt;</span><span>
</span>
</code></pre></pre>
<p>The output would be:</p>
<pre><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-text" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>- 1
</span>  children:
<!-- -->    - 1.1
<!-- -->    - 2.1
<!-- -->- 2
<!-- -->  children:
<!-- -->    - 2.1
<!-- -->
</code></pre></pre>
<p>As you can see, the heading <strong>2.1</strong> is listed under the heading <strong>1</strong>, which is quite incorrect. This happens because we never considered the hierarchy of the headings, and just added all smaller headings to the bigger ones.</p>
<p>Luckily, this is a relatively simple fix. Instead of just checking if the heading has the desired level and then adding it, we now also check if the heading is actually bigger than the current one. If it&#x27;s bigger, all the next elements are of no concern to us, so we can simply return from the function.</p>
<p>This final algorithm is:</p>
<pre><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-typescript" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">function</span><span> </span><span class="token" style="color:#DAD085">createTocTreeFrom</span><span class="token" style="color:#c5c8c6">(</span><span>
</span><span>    headings</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">HTMLHeadingElement</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">,</span><span>
</span><span>    desiredLvl</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token" style="color:#A8FF60">number</span><span class="token" style="color:#c5c8c6">,</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">TocTreeNode</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>    </span><span class="token" style="color:#96CBFE">const</span><span> nodes</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">TocTreeNode</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span> </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">;</span><span>
</span>
<span>    </span><span class="token control-flow" style="color:#96CBFE">for</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#96CBFE">let</span><span> i </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">;</span><span> i </span><span class="token" style="color:#EDEDED">&lt;</span><span> headings</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">length</span><span class="token" style="color:#c5c8c6">;</span><span> i</span><span class="token" style="color:#EDEDED">++</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>        </span><span class="token" style="color:#96CBFE">const</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span> tagName</span><span class="token" style="color:#c5c8c6">,</span><span> innerText</span><span class="token" style="color:#EDEDED">:</span><span> text </span><span class="token" style="color:#c5c8c6">}</span><span> </span><span class="token" style="color:#EDEDED">=</span><span> headings</span><span class="token" style="color:#c5c8c6">[</span><span>i</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>        </span><span class="token" style="color:#96CBFE">const</span><span> matches </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#99CC99">HEADING_TAG_REGEX</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">exec</span><span class="token" style="color:#c5c8c6">(</span><span>tagName</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span>
<span>        </span><span class="token control-flow" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#EDEDED">!</span><span>matches</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>            </span><span class="token control-flow" style="color:#96CBFE">continue</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>        </span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span>        </span><span class="token" style="color:#96CBFE">const</span><span> headingLvl </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">parseInt</span><span class="token" style="color:#c5c8c6">(</span><span>matches</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>        </span><span class="token" style="color:#96CBFE">const</span><span> node</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">TocTreeNode</span><span> </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span> children</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">,</span><span> text </span><span class="token" style="color:#c5c8c6">}</span><span class="token" style="color:#c5c8c6">;</span><span>
</span>
<span>        </span><span class="token control-flow" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>headingLvl </span><span class="token" style="color:#EDEDED">&lt;</span><span> desiredLvl</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>            </span><span class="token control-flow" style="color:#96CBFE">return</span><span> nodes</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>        </span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span>        </span><span class="token control-flow" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>headingLvl </span><span class="token" style="color:#EDEDED">===</span><span> desiredLvl</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>            node</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">children</span><span> </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">createTocTreeFrom</span><span class="token" style="color:#c5c8c6">(</span><span>headings</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">slice</span><span class="token" style="color:#c5c8c6">(</span><span>i </span><span class="token" style="color:#EDEDED">+</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">,</span><span> desiredLvl </span><span class="token" style="color:#EDEDED">+</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>            nodes</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">push</span><span class="token" style="color:#c5c8c6">(</span><span>node</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>        </span><span class="token" style="color:#c5c8c6">}</span><span>
</span><span>    </span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span>    </span><span class="token control-flow" style="color:#96CBFE">return</span><span> nodes</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
</code></pre></pre>
<h1 id="how-to-display-the-toc">How to display the toc</h1>
<h2 id="plain-javascript--typescript">Plain JavaScript / Typescript</h2>
<pre><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-typescript" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">function</span><span> </span><span class="token" style="color:#DAD085">displayToc</span><span class="token" style="color:#c5c8c6">(</span><span>entries</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">TocTreeNode</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">HTMLElement</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>    </span><span class="token" style="color:#96CBFE">const</span><span> listElm </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token dom" style="color:#C6C5FE">document</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">createElement</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#A8FF60">&quot;ul&quot;</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>    listElm</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">style</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">marginLeft</span><span> </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#A8FF60">&quot;1em&quot;</span><span class="token" style="color:#c5c8c6">;</span><span>
</span>
<span>    </span><span class="token control-flow" style="color:#96CBFE">for</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#96CBFE">const</span><span> entry </span><span class="token" style="color:#96CBFE">of</span><span> entries</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>        </span><span class="token" style="color:#96CBFE">const</span><span> entryElm </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token dom" style="color:#C6C5FE">document</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">createElement</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#A8FF60">&quot;li&quot;</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>        entryElm</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">append</span><span class="token" style="color:#c5c8c6">(</span><span>entry</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">text</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span>
<span>        </span><span class="token control-flow" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>entry</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">children</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">length</span><span> </span><span class="token" style="color:#EDEDED">&gt;</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>            entryElm</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">appendChild</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">displayToc</span><span class="token" style="color:#c5c8c6">(</span><span>entry</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">children</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>        </span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span>        listElm</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">appendChild</span><span class="token" style="color:#c5c8c6">(</span><span>entryElm</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>    </span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span>    </span><span class="token control-flow" style="color:#96CBFE">return</span><span> listElm</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
</code></pre></pre>
<h2 id="react">React</h2>
<pre><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-tsx" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">function</span><span> </span><span class="token maybe-class-name" style="color:#DAD085">TableOfContents</span><span class="token" style="color:#c5c8c6">(</span><span class="token parameter" style="color:#c5c8c6">{</span><span class="token parameter"> nodes </span><span class="token parameter" style="color:#c5c8c6">}</span><span class="token parameter" style="color:#EDEDED">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">TableOfContentsProps</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">ReactElement</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>    </span><span class="token control-flow" style="color:#96CBFE">return</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>
</span><span>        </span><span class="token" style="color:#c5c8c6">&lt;</span><span class="token" style="color:#96CBFE">ul</span><span class="token" style="color:#96CBFE"> </span><span class="token" style="color:#A8FF60">style</span><span class="token script language-javascript script-punctuation" style="color:#96CBFE">=</span><span class="token script language-javascript" style="color:#c5c8c6">{</span><span class="token script language-javascript" style="color:#c5c8c6">{</span><span class="token script language-javascript" style="color:#96CBFE"> marginLeft</span><span class="token script language-javascript" style="color:#EDEDED">:</span><span class="token script language-javascript" style="color:#96CBFE"> </span><span class="token script language-javascript" style="color:#A8FF60">&quot;1em&quot;</span><span class="token script language-javascript" style="color:#96CBFE"> </span><span class="token script language-javascript" style="color:#c5c8c6">}</span><span class="token script language-javascript" style="color:#c5c8c6">}</span><span class="token" style="color:#c5c8c6">&gt;</span><span class="token plain-text">
</span><span class="token plain-text">            </span><span class="token" style="color:#c5c8c6">{</span><span>nodes</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">map</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">(</span><span class="token parameter">node</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token arrow" style="color:#EDEDED">=&gt;</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>
</span><span>                </span><span class="token" style="color:#c5c8c6">&lt;</span><span class="token" style="color:#c5c8c6">&gt;</span><span class="token plain-text">
</span><span class="token plain-text">                    </span><span class="token" style="color:#c5c8c6">&lt;</span><span class="token" style="color:#96CBFE">li</span><span class="token" style="color:#c5c8c6">&gt;</span><span class="token" style="color:#c5c8c6">{</span><span>node</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">text</span><span class="token" style="color:#c5c8c6">}</span><span class="token" style="color:#c5c8c6">&lt;/</span><span class="token" style="color:#96CBFE">li</span><span class="token" style="color:#c5c8c6">&gt;</span><span class="token plain-text">
</span><span class="token plain-text">                    </span><span class="token" style="color:#c5c8c6">{</span><span>node</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">children</span><span> </span><span class="token" style="color:#EDEDED">&amp;&amp;</span><span> </span><span class="token" style="color:#c5c8c6">&lt;</span><span class="token" style="color:#FFFFB6;text-decoration:underline">TableOfContents</span><span class="token" style="color:#96CBFE"> </span><span class="token" style="color:#A8FF60">nodes</span><span class="token script language-javascript script-punctuation" style="color:#96CBFE">=</span><span class="token script language-javascript" style="color:#c5c8c6">{</span><span class="token script language-javascript" style="color:#96CBFE">node</span><span class="token script language-javascript" style="color:#c5c8c6">.</span><span class="token script language-javascript property-access" style="color:#96CBFE">children</span><span class="token script language-javascript" style="color:#c5c8c6">}</span><span class="token" style="color:#96CBFE"> </span><span class="token" style="color:#c5c8c6">/&gt;</span><span class="token" style="color:#c5c8c6">}</span><span class="token plain-text">
</span><span class="token plain-text">                </span><span class="token" style="color:#c5c8c6">&lt;/</span><span class="token" style="color:#c5c8c6">&gt;</span><span>
</span><span>            </span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">}</span><span class="token plain-text">
</span><span class="token plain-text">        </span><span class="token" style="color:#c5c8c6">&lt;/</span><span class="token" style="color:#96CBFE">ul</span><span class="token" style="color:#c5c8c6">&gt;</span><span>
</span><span>    </span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
</code></pre></pre></div><nav class="tableOfContentsLayout_toc__ZjzLh" aria-label="Table of contents"><ul class="tableOfContents_list__b8d6s"></ul></nav></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, {})\n  })) : _createMdxContent();\n  function _createMdxContent() {\n    const _components = Object.assign({\n      p: \"p\",\n      strong: \"strong\",\n      h1: \"h1\",\n      pre: \"pre\",\n      code: \"code\",\n      h2: \"h2\"\n    }, _provideComponents(), props.components);\n    return _jsxs(_Fragment, {\n      children: [_jsxs(_components.p, {\n        children: [\"I wanted to display a list of all headings on my page. This is commonly known as a \\\"table of contents\\\".\\nAfter looking around online, I found an algorithm that was able to generate a TOC (\", _jsx(_components.strong, {\n          children: \"t\"\n        }), \"able \", _jsx(_components.strong, {\n          children: \"o\"\n        }), \"f \", _jsx(_components.strong, {\n          children: \"c\"\n        }), \"ontents) from a list of headings. Although only up to two levels deep. So H1s and H2s.\"]\n      }), \"\\n\", _jsx(_components.h1, {\n        id: \"old-algorithm\",\n        children: \"Old algorithm\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"I don't remember where I got the idea from, but here is the code. It's more for completeness sake anyway.\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-typescript\",\n          children: \"function generateHeadingsTreeFrom(\\n    headingElements: HTMLHeadingElement[],\\n): Heading[] {\\n    const headings: Heading[] = [];\\n\\n    for (const headingElement of headingElements) {\\n        const { innerText: text, id, nodeName } = headingElement;\\n        const heading: Heading = { children: [], id, text };\\n\\n        if (nodeName === \\\"H1\\\") {\\n            headings.push(heading);\\n        } else if (nodeName === \\\"H2\\\" \u0026\u0026 headings.length \u003e 0) {\\n            headings[headings.length - 1].children.push(heading);\\n        }\\n    }\\n\\n    return headings;\\n}\\n\"\n        })\n      }), \"\\n\", _jsx(_components.h1, {\n        id: \"setup\",\n        children: \"Setup\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"I wanted to create an algorithm that can handle any depth. Let's go through my thought process on how to create this.\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"First, this is the code I use to get my heading elements:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-typescript\",\n          children: \"const headings = Array.from(\\n    document.querySelectorAll(\\\"h1, h2, h3, h4, h5, h6\\\"),\\n) as HTMLHeadingElement[]; // I'm using typescript btw :)\\n\\nconst tocTree = createTocTreeFrom(headings); // This is the function to implement.\\n\"\n        })\n      }), \"\\n\", _jsx(_components.h1, {\n        id: \"toctreenode\",\n        children: _jsx(_components.code, {\n          children: \"TocTreeNode\"\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Here is the \", _jsx(_components.code, {\n          children: \"TocTreeNode\"\n        }), \" definition:\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-typescript\",\n          children: \"interface TocTreeNode {\\n    text: string;\\n    children: TocTreeNode[];\\n}\\n\"\n        })\n      }), \"\\n\", _jsx(_components.h1, {\n        id: \"new-any-depth-toc\",\n        children: \"New \\\"any depth\\\" toc\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-typescript\",\n          children: \"function createTocTreeFrom(headings: HTMLHeadingElement[]): TocTreeNode[] {\\n    const nodes: TocTreeNode[] = [];\\n\\n    for (const { tagName, innerText: text } of headings) {\\n        const matches = HEADING_TAG_REGEX.exec(tagName);\\n\\n        if (!matches) {\\n            continue;\\n        }\\n\\n        const headingLvl = parseInt(matches[1]);\\n\\n        if (headingLvl !== 1) {\\n            continue;\\n        }\\n\\n        nodes.push({ children: [], text });\\n    }\\n\\n    return nodes;\\n}\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"The code above returns a simple list of all H1 elements.\\nSo let's step it up a notch. First, add an additional parameter \", _jsx(_components.code, {\n          children: \"desiredLvl\"\n        }), \",  so what we look for can be customized.\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-typescript\",\n          children: \"function createTocTreeFrom(\\n    headings: HTMLHeadingElement[],\\n    desiredLvl: number,\\n): TocTreeNode[] {\\n    // ....\\n\\n    if (headingLvl !== desiredLvl) {\\n        continue;\\n    }\\n\\n    // ...\\n}\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Let's add depth to it, by actually providing something for the \", _jsx(_components.code, {\n          children: \"children\"\n        }), \" attribute.  For now, let's just call the function recursively, but one level deeper, so \", _jsx(_components.code, {\n          children: \"desiredLvl + 1\"\n        }), \". We also want to not include previous elements, as otherwise, we would loop indefinitely.\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-typescript\",\n          children: \"function createTocTreeFrom(\\n    headings: HTMLHeadingElement[],\\n    desiredLvl: number,\\n): TocTreeNode[] {\\n    const nodes: TocTreeNode[] = [];\\n\\n    for (let i = 0; i \u003c headings.length; i++) {\\n        const { tagName, innerText: text } = headings[i];\\n        const matches = HEADING_TAG_REGEX.exec(tagName);\\n\\n        if (!matches) {\\n            continue;\\n        }\\n\\n        const headingLvl = parseInt(matches[1]);\\n\\n        if (headingLvl !== desiredLvl) {\\n            continue;\\n        }\\n\\n        const children = createTocTreeFrom(headings.slice(i + 1), desiredLvl + 1);\\n\\n        nodes.push({ children, text });\\n    }\\n\\n    return nodes;\\n}\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"But this algorithm is flawed. Consider the following headings:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-html\",\n          children: \"\u003ch1\u003e1\u003c/h1\u003e\\n\u003ch2\u003e1.1\u003c/h2\u003e\\n\u003ch1\u003e2\u003c/h1\u003e\\n\u003ch2\u003e2.1\u003c/h2\u003e\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"The output would be:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-text\",\n          children: \"- 1\\n  children:\\n    - 1.1\\n    - 2.1\\n- 2\\n  children:\\n    - 2.1\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"As you can see, the heading \", _jsx(_components.strong, {\n          children: \"2.1\"\n        }), \" is listed under the heading \", _jsx(_components.strong, {\n          children: \"1\"\n        }), \", which is quite incorrect. This happens because we never considered the hierarchy of the headings, and just added all smaller headings to the bigger ones.\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Luckily, this is a relatively simple fix. Instead of just checking if the heading has the desired level and then adding it, we now also check if the heading is actually bigger than the current one. If it's bigger, all the next elements are of no concern to us, so we can simply return from the function.\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"This final algorithm is:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-typescript\",\n          children: \"function createTocTreeFrom(\\n    headings: HTMLHeadingElement[],\\n    desiredLvl: number,\\n): TocTreeNode[] {\\n    const nodes: TocTreeNode[] = [];\\n\\n    for (let i = 0; i \u003c headings.length; i++) {\\n        const { tagName, innerText: text } = headings[i];\\n        const matches = HEADING_TAG_REGEX.exec(tagName);\\n\\n        if (!matches) {\\n            continue;\\n        }\\n\\n        const headingLvl = parseInt(matches[1]);\\n        const node: TocTreeNode = { children: [], text };\\n\\n        if (headingLvl \u003c desiredLvl) {\\n            return nodes;\\n        }\\n\\n        if (headingLvl === desiredLvl) {\\n            node.children = createTocTreeFrom(headings.slice(i + 1), desiredLvl + 1);\\n            nodes.push(node);\\n        }\\n    }\\n\\n    return nodes;\\n}\\n\"\n        })\n      }), \"\\n\", _jsx(_components.h1, {\n        id: \"how-to-display-the-toc\",\n        children: \"How to display the toc\"\n      }), \"\\n\", _jsx(_components.h2, {\n        id: \"plain-javascript--typescript\",\n        children: \"Plain JavaScript / Typescript\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-typescript\",\n          children: \"function displayToc(entries: TocTreeNode[]): HTMLElement {\\n    const listElm = document.createElement(\\\"ul\\\");\\n    listElm.style.marginLeft = \\\"1em\\\";\\n\\n    for (const entry of entries) {\\n        const entryElm = document.createElement(\\\"li\\\");\\n        entryElm.append(entry.text);\\n\\n        if (entry.children.length \u003e 0) {\\n            entryElm.appendChild(displayToc(entry.children));\\n        }\\n\\n        listElm.appendChild(entryElm);\\n    }\\n\\n    return listElm;\\n}\\n\"\n        })\n      }), \"\\n\", _jsx(_components.h2, {\n        id: \"react\",\n        children: \"React\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-tsx\",\n          children: \"function TableOfContents({ nodes }: TableOfContentsProps): ReactElement {\\n    return (\\n        \u003cul style={{ marginLeft: \\\"1em\\\" }}\u003e\\n            {nodes.map((node) =\u003e (\\n                \u003c\u003e\\n                    \u003cli\u003e{node.text}\u003c/li\u003e\\n                    {node.children \u0026\u0026 \u003cTableOfContents nodes={node.children} /\u003e}\\n                \u003c/\u003e\\n            ))}\\n        \u003c/ul\u003e\\n    );\\n}\\n\"\n        })\n      })]\n    });\n  }\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/bits/[name]","query":{"name":"toc"},"buildId":"C-814SSFJMFSiMFrA5QZR","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>